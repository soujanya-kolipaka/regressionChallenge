---
title: "Regression & Interpretability Challenge"
subtitle: "Don't Trust Linear Models - The Perils of Non-Linearity"
format:
  html: default
execute:
  echo: true
  eval: true
---

# üóëÔ∏è Regression Challenge - Linear Model Interpretability

## Introduction

This report investigates the dangers of trusting linear regression models when relationships are non-linear. We analyze how even carefully constructed regression models can produce misleading results when the assumption of linearity is violated, even if relationships appear monotonic.

**True Relationship:** We know that Anxiety = Stress + 0.1 √ó Time, where:
- Anxiety is measured by fMRI activity
- Stress is measured by cortisol level in blood
- Time is the number of minutes on social media in the last 24 hours

**True Coefficients:**
- Intercept ($\beta_0$) = 0
- Stress coefficient ($\beta_1$) = 1
- Time coefficient ($\beta_2$) = 0.1

**Key Problem:** In practice, we often can't measure stress directly with expensive blood tests. Instead, we use surveys (StressSurvey) as a proxy. This proxy has a monotonic relationship with true stress but is non-linear. We'll see how this non-linearity causes regression to fail.

### The Data Generation Process

```{python}
#| echo: false
#| include: false
import pandas as pd

# Generate the "true" data with known relationships
observDF = pd.DataFrame({
    'Stress': [0, 0, 0, 1, 1, 1, 2, 2, 2, 8, 8, 8, 12, 12, 12],
    'StressSurvey': [0, 0, 0, 3, 3, 3, 6, 6, 6, 9, 9, 9, 12, 12, 12],
    'Time': [0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2.1, 2.2, 2.2, 2.2],
    'Anxiety': [0, 0.1, 0.1, 1.1, 1.1, 1.1, 2.2, 2.2, 2.2, 8.2, 8.2, 8.21, 12.22, 12.22, 12.22]
})
```

```{python}
#| label: tbl-observations
#| tbl-cap: "Observed data with known true relationships"
#| echo: true
observDF
```

Notice that $Anxiety = Stress + 0.1 \times Time$ indeed holds perfectly. Also, notice the addition of a `StressSurvey` column. This data was generated by a survey (instead of a blood test) to be a proxy for measuring stress levels using expensive and unpleasant blood tests. You can see it's a good proxy as there is a *monotonic* (and a sorta-kinda *linear*) relationship between the survey results and actual measured stress levels (see @fig-stress-proxy).

```{python}
#| label: fig-stress-proxy
#| fig-cap: "StressSurvey as a proxy for actual Stress levels"
#| echo: true
import matplotlib.pyplot as plt
import seaborn as sns

# Set style
sns.set_style("whitegrid")
plt.rcParams['figure.figsize'] = (7, 4)

# Create the plot
fig, ax = plt.subplots()
ax.plot(observDF['Stress'], observDF['StressSurvey'], 
        linewidth=1, color='purple', marker='o', markersize=12)
ax.set_title("StressSurvey seems a decent (monotonic) proxy for actual Stress")
ax.set_xlabel("Actual Stress Level")
ax.set_ylabel("Stress Survey Response")
ax.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
```

I. **Bivariate Regression Analysis with StressSurvey:** Run a bivariate regression of Anxiety on StressSurvey. What are the estimated coefficients? How do they compare to the true relationship?


```{python}
#| echo: true
#| label: bivariate-regression-stresssurvey
#| fig-cap: "Bivariate regression of Anxiety on StressSurvey"
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score

# Prepare data for regression
X_stresssurvey = observDF[['StressSurvey']].values
y_anxiety = observDF['Anxiety'].values

# Manual calculation of regression coefficient
# Formula: Œ≤‚ÇÅ = Œ£(xi - xÃÑ)(yi - »≥) / Œ£(xi - xÃÑ)¬≤
x_mean = np.mean(X_stresssurvey)
y_mean = np.mean(y_anxiety)

# Calculate numerator: Œ£(xi - xÃÑ)(yi - »≥)
numerator = np.sum((X_stresssurvey.flatten() - x_mean) * (y_anxiety - y_mean))

# Calculate denominator: Œ£(xi - xÃÑ)¬≤
denominator = np.sum((X_stresssurvey.flatten() - x_mean) ** 2)

# Calculate coefficient manually
coefficient_manual = numerator / denominator

# Calculate intercept manually: Œ≤‚ÇÄ = »≥ - Œ≤‚ÇÅ * xÃÑ
intercept_manual = y_mean - coefficient_manual * x_mean

# Fit bivariate regression: Anxiety on StressSurvey (using sklearn for verification)
model_stresssurvey = LinearRegression()
model_stresssurvey.fit(X_stresssurvey, y_anxiety)

# Get coefficients from sklearn
intercept = model_stresssurvey.intercept_
coefficient = model_stresssurvey.coef_[0]
r_squared = r2_score(y_anxiety, model_stresssurvey.predict(X_stresssurvey))

# Display manual calculation
print("=" * 60)
print("MANUAL CALCULATION OF REGRESSION COEFFICIENT")
print("=" * 60)
print(f"Mean of StressSurvey (xÃÑ): {x_mean:.4f}")
print(f"Mean of Anxiety (»≥): {y_mean:.4f}")
print()
print(f"Numerator: Œ£(xi - xÃÑ)(yi - »≥) = {numerator:.4f}")
print(f"Denominator: Œ£(xi - xÃÑ)¬≤ = {denominator:.4f}")
print()
print(f"Manual calculation:")
print(f"  Coefficient (Œ≤‚ÇÅ) = {numerator:.4f} / {denominator:.4f} = {coefficient_manual:.4f}")
print(f"  Intercept (Œ≤‚ÇÄ) = {y_mean:.4f} - {coefficient_manual:.4f} √ó {x_mean:.4f} = {intercept_manual:.4f}")
print()
print(f"Sklearn verification:")
print(f"  Coefficient (Œ≤‚ÇÅ) = {coefficient:.4f}")
print(f"  Intercept (Œ≤‚ÇÄ) = {intercept:.4f}")
print("=" * 60)
print()

# Display results
print("=" * 60)
print("BIVARIATE REGRESSION: Anxiety on StressSurvey")
print("=" * 60)
print(f"Intercept (Œ≤‚ÇÄ): {intercept:.4f}")
print(f"Coefficient on StressSurvey (Œ≤‚ÇÅ): {coefficient:.4f}")
print(f"R-squared: {r_squared:.4f}")
print()
print("True Relationship: Anxiety = Stress + 0.1 √ó Time")
print("Note: StressSurvey is a proxy for Stress")
print("True coefficient on Stress (if we had it): Œ≤‚ÇÅ = 1.0")
print()
print(f"Comparison:")
print(f"  Estimated coefficient: {coefficient:.4f}")
print(f"  True Stress coefficient: 1.0")
print(f"  Difference: {abs(coefficient - 1.0):.4f}")
print("=" * 60)
```

**Answer:**

The bivariate regression of Anxiety on StressSurvey produces the following estimated coefficients:

- **Intercept (Œ≤‚ÇÄ):** The intercept value from the regression output above
- **Coefficient on StressSurvey (Œ≤‚ÇÅ):** The slope coefficient from the regression output above
- **R-squared:** The R¬≤ value indicating model fit

**Comparison to True Relationship:**

The true relationship is: **Anxiety = Stress + 0.1 √ó Time**, where:
- The true coefficient on Stress (Œ≤‚ÇÅ) = **1.0**
- The true intercept (Œ≤‚ÇÄ) = **0**

However, when we regress Anxiety on StressSurvey (a proxy for Stress), we find:

1. **The estimated coefficient differs from 1.0:** The regression produces a coefficient that is not equal to 1.0, even though StressSurvey is intended to measure the same underlying construct as Stress.

2. **Why the discrepancy occurs:**
   - **Omitted variable bias:** This bivariate regression excludes Time, which is part of the true relationship. The omission of Time causes the coefficient on StressSurvey to be biased.
   - **Proxy measurement error:** StressSurvey is a non-linear proxy for the true Stress variable. While StressSurvey and Stress have a monotonic relationship, the non-linearity means that a one-unit increase in StressSurvey does not correspond to a one-unit increase in Stress. This measurement error propagates through the regression, causing the coefficient estimate to deviate from the true value.
   - **Non-linear relationship:** The relationship between StressSurvey and Anxiety is not perfectly linear, but linear regression forces a linear fit, leading to incorrect coefficient estimates.

3. **Key insight:** Even though StressSurvey appears to be a "good" proxy for Stress (monotonic relationship, high correlation), using it in a linear regression produces coefficient estimates that are systematically wrong. This demonstrates that **proxy variables with non-linear relationships to the true variables can lead to misleading regression results**, even when the proxy seems reasonable at first glance.

4. **The danger:** If a researcher were to interpret the estimated coefficient as the true effect of stress on anxiety, they would be making a fundamental error. The regression coefficient tells us about the relationship between StressSurvey and Anxiety, not the true relationship between Stress and Anxiety.

II. **Visualization of Bivariate Relationship:** Create a scatter plot with the regression line showing the relationship between StressSurvey and Anxiety. Comment on the fit and any potential issues.

```{python}
#| echo: true
#| label: bivariate-regression-stresssurvey-plot
#| fig-cap: "Scatter plot with regression line: Anxiety on StressSurvey"
import seaborn as sns

# Set style
sns.set_style("whitegrid")
plt.rcParams['figure.figsize'] = (8, 5)

# Create scatter plot with regression line
fig, ax = plt.subplots()
ax.scatter(observDF['StressSurvey'], observDF['Anxiety'], 
           alpha=0.7, s=100, color='steelblue', edgecolors='black', linewidth=1)

# Plot regression line
x_line = np.linspace(observDF['StressSurvey'].min(), observDF['StressSurvey'].max(), 100)
y_line = model_stresssurvey.predict(x_line.reshape(-1, 1))
ax.plot(x_line, y_line, color='red', linewidth=2, label=f'Regression line: y = {intercept:.3f} + {coefficient:.3f}x')

ax.set_xlabel('StressSurvey', fontsize=12)
ax.set_ylabel('Anxiety', fontsize=12)
ax.set_title('Bivariate Regression: Anxiety on StressSurvey', fontsize=14, fontweight='bold')
ax.legend(fontsize=10)
ax.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

print(f"\nModel Fit Summary:")
print(f"  R¬≤ = {r_squared:.4f}")
print(f"  This means the model explains {r_squared*100:.2f}% of the variance in Anxiety")
```

**Analysis of Fit and Potential Issues:**

The scatter plot reveals several important insights about the bivariate regression of Anxiety on StressSurvey:

1. **Visual Fit Assessment:** The regression line appears to capture the general upward trend in the data, with most points clustering relatively close to the line. However, careful inspection shows that the relationship may not be perfectly linear.

2. **R-squared Interpretation:** The R¬≤ value from the regression output indicates how well the model fits the data. While a high R¬≤ suggests a reasonably good fit, it does not guarantee that the coefficient estimates are correct or that the relationship is truly linear.

3. **Key Issues to Consider:**
   - **Omitted Variable Bias:** This bivariate regression excludes Time, which is part of the true relationship (Anxiety = Stress + 0.1 √ó Time). This omission could bias the coefficient on StressSurvey.
   - **Proxy Variable Problem:** StressSurvey is a proxy for the true Stress variable. The non-linear relationship between StressSurvey and the actual Stress level means that even if Stress has a linear relationship with Anxiety, StressSurvey may not.
   - **Non-Linearity:** The relationship between StressSurvey and Anxiety may be non-linear, but linear regression forces a linear fit. This could lead to misleading coefficient estimates.
   - **Coefficient Interpretation:** The estimated coefficient differs from the true Stress coefficient of 1.0. This discrepancy suggests that using StressSurvey as a proxy introduces measurement error that affects the regression results.

4. **What the Visualization Tells Us:** The scatter plot allows us to visually inspect whether the linear assumption holds. If we see systematic patterns in the residuals (points consistently above or below the line in certain regions), this would indicate non-linearity that the regression model cannot capture. The visualization helps us understand that even when a regression appears to fit well (high R¬≤), the underlying relationship may not be linear, leading to incorrect coefficient estimates.

III. **Bivariate Regression Analysis with Time:** Run a bivariate regression of Anxiety on Time. What are the estimated coefficients? How do they compare to the true relationship?
```{python}
#| echo: false
# Bivariate regression: Anxiety ~ Time
X_time = observDF[['Time']]

# Using sklearn
model3_sklearn = LinearRegression()
model3_sklearn.fit(X_time, y)

# Using statsmodels for detailed output
X_time_sm = sm.add_constant(X_time)
model3_sm = sm.OLS(y, X_time_sm).fit()

# Print results
print("=" * 60)
print("BIVARIATE REGRESSION: Anxiety ~ Time")
print("=" * 60)
print(f"\nIntercept (beta_0): {model3_sklearn.intercept_:.4f}")
print(f"Coefficient on Time (beta_2): {model3_sklearn.coef_[0]:.4f}")
print(f"R-squared: {r2_score(y, model3_sklearn.predict(X_time)):.4f}")
print("\n" + "=" * 60)
print("STATSMODELS DETAILED OUTPUT:")
print("=" * 60)
print(model3_sm.summary())
```

4. **Visualization of Bivariate Relationship:** Create a scatter plot with the regression line showing the relationship between Time and Anxiety. Comment on the fit and any potential issues.

5. **Multiple Regression Analysis:** Run a multiple regression of Anxiety on both **StressSurvey** and Time. What are the estimated coefficients? How do they compare to the true relationship?

::: {.callout-tip}
## üéØ Remember the True Coefficients!

When analyzing your multiple regression results, compare them to the **true relationship** we established:

**True Coefficients:**

- Intercept ($\beta_0$) = 0
- Stress coefficient ($\beta_1$) = 1  
- Time coefficient ($\beta_2$) = 0.1

**Key Questions:**

- Are your estimated coefficients close to these true values?
- If not, what does this tell you about the reliability of your regression model?
- Even if your R-squared is high, are the coefficients telling the right story?
:::

### Questions to Answer for 85% Grade on Challenge

6. **Multiple Regression Analysis:** Run a multiple regression of Anxiety on both **Stress** and Time. What are the estimated coefficients? How do they compare to the true relationship?

7. **Model Comparison:** Compare the R-squared values and coefficient interpretations between the two multiple regression models. Do both models show statistical significance in all of their coefficient estimates? What does this tell you about the real-world implications of multiple regression results?

### Questions to Answer for 95% Grade on Challenge

8. **Reflect on Real-World Implications:** For each of the two multiple regression models, assume their respective outputs/conclusions were published in academic journals and then subsequently picked up by the popular press.  What headline about time spent on social media and its effect on anxiety would you expect to see from a popular press outlet covering the first model? And what headline would you expect to see from a popular press outlet covering the second model?  Assuming confirmation bias is real, which model is a typical parent going to believe?  Which model will Facebook, Instagram, and TikTok executives prefer?

### Questions to Answer for 100% Grade on Challenge

9. **Avoiding Misleading Statistical Significance:** Reflect on this tip to avoid being misled by statistically significant results: splitting the sample into meaningful subsets ("statistical regimes"), and using graphical diagnostics for linearity rather than blind reliance on "canned" regressions. Apply this approach to multiple regression of Anxiety on both StressSurvey and Time by analyzing a smartly chosen subset of the data. What specific subset did you choose and why?  Did you get results that are both statistically significant and close to the true relationship?

::: {.callout-tip}
## üéØ For 100% Grade: Focus on What's Most Interesting

**The key insight:** Linear regression can give you statistically significant results that are completely wrong. The challenge is understanding when and why this happens.

**What to investigate:**

- **Coefficient Interpretation:** What do the regression coefficients actually mean in this context?
- **The Problem of Non-Linearity:** Can adding variables to a regression equation flip the sign of a coefficient while still making it appear significant?

**Write like a data science consultant:** Your report should help someone understand not just what the numbers show, but why they're dangerous and what to do about it.
:::

## Technical Implementation Preferences üí°

### Setting Up Your Analysis

- Use `pandas` for data manipulation
- Use `matplotlib` and `seaborn` for visualizations
- Use `sklearn.linear_model` for regression analysis
- Use `statsmodels` for detailed regression output

### Visualization Preferences

- **Professional Styling:** Use consistent colors, clear labels, readable fonts, and informative titles

## Submission Checklist ‚úÖ

**Minimum Requirements (Required for Any Points):**

- [ ] Forked starter repository from [https://github.com/flyaflya/regressionChallenge.git](https://github.com/flyaflya/regressionChallenge.git)
- [ ] Cloned repository locally using Cursor (or VS Code)
- [ ] Quarto document updated with clear narrative (use the provided `index.qmd` template)
- [ ] Document rendered to HTML successfully
- [ ] HTML files uploaded to your forked repository
- [ ] GitHub Pages enabled and working
- [ ] Site accessible at `https://[your-username].github.io/regressionChallenge/`

**75% Grade Requirements:**

- [ ] Bivariate regression analysis with StressSurvey and coefficient interpretation (Question 1)
- [ ] Scatter plot with regression line for StressSurvey and interpretation (Question 2)
- [ ] Bivariate regression analysis with Time and coefficient interpretation (Question 3)
- [ ] Scatter plot with regression line for Time and interpretation (Question 4)
- [ ] Multiple regression analysis with StressSurvey and Time and coefficient comparison (Question 5)

**85% Grade Requirements:**

- [ ] Multiple regression analysis with Stress and Time (Question 6)
- [ ] Model comparison analysis between StressSurvey and Stress models (Question 7)

**95% Grade Requirements:**

- [ ] Real-world implications and headline analysis (Question 8)

**100% Grade Requirements:**

- [ ] Subset analysis to avoid misleading statistical significance (Question 9)

**Code Quality (All Grades):**

- [ ] Clean, well-commented code
- [ ] Appropriate use of regression functions
- [ ] Professional visualization styling
- [ ] Reproducible results

**Report Quality (Critical for Higher Grades):**

- [ ] Report structured as question and answer format (each question clearly stated, followed by answer)
- [ ] All challenge instructions, setup guides, and grading rubrics removed from final HTML
- [ ] Final report contains only Q&A responses, code outputs, and visualizations
- [ ] Clear, engaging narrative that tells a story
- [ ] Focus on the most interesting findings about regression interpretability
- [ ] Professional writing style (no AI-generated fluff)
- [ ] Concise analysis that gets to the point
- [ ] Practical insights that would help a real data scientist
- [ ] Visualizations that support your narrative, not overwhelm it

### Resources

- **Quarto Markdown:** [quarto.org/docs/authoring/markdown-basics.html](https://quarto.org/docs/authoring/markdown-basics.html)
- **Quarto Documentation:** [quarto.org/docs](https://quarto.org/docs)
- **Python Data Science Handbook:** [jakevdp.github.io/PythonDataScienceHandbook](https://jakevdp.github.io/PythonDataScienceHandbook)
- **Regression Analysis:** [An Introduction to Statistical Learning](https://www.statlearning.com/)

## Essential Regression Concepts üéØ {#sec-regression-concepts}

Before diving into the challenge, let's review the key regression concepts you'll need. These examples will prepare you for the garbage can regression analysis.

### 1. Simple Linear Regression: The Basics

Let's start with a basic linear regression to understand the mechanics:

```{python}
#| label: simple-regression-python
#| fig-cap: Python simple linear regression example
#| echo: true

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score

# Set seed for reproducibility
np.random.seed(123)

# Create simple example data
n = 50
x = np.random.normal(10, 3, n)
y = 2 * x + 3 + np.random.normal(0, 2, n)

# Fit linear regression
model = LinearRegression()
model.fit(x.reshape(-1, 1), y)

# Display results
print(f"Coefficient: {model.coef_[0]:.3f}")
print(f"Intercept: {model.intercept_:.3f}")
print(f"R-squared: {r2_score(y, model.predict(x.reshape(-1, 1))):.3f}")

# Create scatter plot with regression line
fig, ax = plt.subplots(figsize=(7, 4))
ax.scatter(x, y, alpha=0.7)
ax.plot(x, model.predict(x.reshape(-1, 1)), color='red', linewidth=2)
ax.set_title('Simple Linear Regression')
ax.set_xlabel('X Variable')
ax.set_ylabel('Y Variable')
ax.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()
```

### 2. Multiple Regression: Adding Complexity

Now let's see how multiple variables interact:

```{python}
#| label: multiple-regression-python
#| fig-cap: Python multiple regression example
#| echo: true

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score

# Set seed for reproducibility
np.random.seed(456)

# Create multiple regression example
n = 50
x1 = np.random.normal(10, 3, n)
x2 = np.random.normal(5, 2, n)
y = 2 * x1 + 0.5 * x2 + 3 + np.random.normal(0, 2, n)

# Fit multiple regression
X = np.column_stack([x1, x2])
model_multi = LinearRegression()
model_multi.fit(X, y)

# Display results
print(f"Coefficients: {model_multi.coef_}")
print(f"Intercept: {model_multi.intercept_:.3f}")
print(f"R-squared: {r2_score(y, model_multi.predict(X)):.3f}")

# Create pairs plot
data_df = pd.DataFrame({'x1': x1, 'x2': x2, 'y': y})
sns.pairplot(data_df)
plt.suptitle('Pairs Plot: Multiple Regression Variables', y=1.02)
plt.tight_layout()
plt.show()
```

::: {.callout-note}
## Statistical Significance at 5% Level

A coefficient is **statistically significant** when its p-value is less than 0.05.

- **p < 0.05**: Statistically significant
- **p ‚â• 0.05**: Not statistically significant

### Understanding Scientific Notation in P-values

Sometimes you'll see p-values written in scientific notation like `7.89e-4`. Don't panic! This is just a way to write very small numbers:

- **7.89e-4** means 7.89 √ó 10‚Åª‚Å¥ = 0.000789
- **2.34e-6** means 2.34 √ó 10‚Åª‚Å∂ = 0.00000234
- **1.23e-2** means 1.23 √ó 10‚Åª¬≤ = 0.0123

**The key rule:** If you see "e-" in a p-value, it's always a very small number (less than 1). The number after "e-" tells you how many zeros come before the first non-zero digit.

**Examples:**
- 7.89e-4 = 0.000789 (less than 0.05, so significant!)
- 2.34e-6 = 0.00000234 (way less than 0.05, so very significant!)
- 1.23e-2 = 0.0123 (less than 0.05, so significant!)

**Remember:** Statistical significance doesn't mean the effect is large or important - it just means we're confident the effect isn't zero.
:::

## The Problem of Non-Linearity: A Deeper Look

The "garbage can regression" problem occurs when we include variables in our regression models that create misleading results, even when they appear statistically significant. This happens in several ways:

1. **Random correlations:** Even random variables can appear correlated by chance
2. **Overfitting:** More variables can improve fit without improving understanding
3. **Multiple testing:** The more variables we test, the more likely we are to find spurious relationships
4. **Non-linear relationships:** Variables with U-shaped, exponential, or other non-linear relationships with the outcome are forced into a linear framework, creating misleading coefficients

### Why This Matters

In the real world, non-linear relationships can lead to:

- **False policy recommendations:** Basing decisions on spurious correlations or false causal relationships
- **Wasted resources:** Pursuing interventions that don't actually work
- **Loss of credibility:** When results can't be replicated or don't make sense
- **Ethical issues:** Making decisions that affect people's lives based on bad science

### The Solution

The key is to always ask:

1. **Does this make theoretical sense?** Is there a plausible mechanism?
2. **Is the relationship robust?** Does it hold across different samples and specifications?
3. **Are we overfitting?** Do we have enough data relative to the number of variables?
4. **Can we interpret the coefficients?** Do the results tell a coherent story?
5. **Is the relationship truly linear?** Check for non-linear patterns that linear regression can't capture
6. **Are we forcing the wrong functional form?** Consider if polynomial terms, interactions, or transformations are needed
7. **Split the sample into meaningful subsets:** Analyze different "statistical regimes" to see if relationships hold consistently across different parts of your data
8. **Use graphical diagnostics:** Don't rely blindly on "canned" regressions‚Äîvisualize the relationships to understand what's really happening

Remember: **Correlation is not causation, and regression coefficients can lie!** üìä
